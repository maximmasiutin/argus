<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1251">

</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

</OBJECT>

<H1><SUP><A NAME="idh_asyncflow"></A></SUP>Контроль потока данных</H1>

<P>Контроль потока данных (flow control) — это возможность приостанавливать поток данных при асинхронной передаче по запросу удаленной системы. Контроль потока данных необходим, когда скорость обработки принимаемых данных может быть меньше скорости поступления данных.</P>

<P>Случается, что данные поступают со слишком большой скоростью, а у компьютера не хватает процессорных ресурсов, необходимых для их обработки. Тогда, через некоторое время, может наступить переполнение буфера приема, и данные, поступающие от удаленной системы, будут потеряны. </P>

<P>Контроль потока данных можно рассматривать с двух сторон: контроль потока принимаемых данных и контроль потока передаваемых данных. Контроль потока принимаемых данных означает возможность сообщать удаленной стороне о том, что ей следует приостановить передачу данных. Контроль потока передаваемых данных означает возможность правильно отрабатывать запрос удаленной стороны о приостановке передачи данных.</P>

<P>Система Аргус практически никогда не пользуется контролем потока принимаемых данных. Чтением из порта занимается отдельный подпроцесс с повышенным приоритетом, и переполнения буфера приема практически никогда не происходит.</P>

<P>Если использовать 19200-BPS модем на скорости порта 38400, данные будут поступать от компьютера к модему с вдвое большей скоростью, то есть в среднем половину времени входной буфер модема будет заполнен, и модем будет запрашивать о приостановке передачи потока. Чтобы предотвратить потери данных, система Аргус должна правильно отрабатывать запросы модема на приостановку передачи потока.</P>

<P>Существует два типа контроля потока данных — аппаратный и программный. </P>

<h2>Аппаратный контроль потока данных</h2>

<P>Аппаратный контроль потока данных осуществляется при помощи контрольных сигналов последовательного кабеля. Название и значение этих сигналов соответствует спецификации RS-232.</P>

<P>Аппаратный контроль потока данных, в соответствии со стандартами, требует, чтобы модем поднял сигнал CTS перед тем, как PC начнет передавать символы. PC, в свою очередь, должен опустить сигнал RTS, когда его входной заполнится во время приема. Как только PC обработает весь входной буфер, он снова поднимает RTS.</P>

<P>Вот и все, что Вам необходимо знать об аппаратном контроле потока данных при работе с системой Аргус. Далее следует более детальный обзор темы.</P>

<TABLE cols=3 width=223>

<TR VALIGN="top">
<TD width=40%>PC</TD>
<TD width=17%> </TD>
<TD width=43%>Устройство</TD>
</TR>

<TR VALIGN="top">
<TD width=40%><B>data input</B></TD>
<TD width=17%>п</TD>
<TD width=43%><B>data output</B></TD>
</TR>

<TR VALIGN="top">
<TD width=40%><B>data output</B></TD>
<TD width=17%>р</TD>
<TD width=43%><B>data input</B></TD>
</TR>

<TR VALIGN="top">
<TD width=40%>
<PRE><CODE>DTR</CODE></PRE>
</TD>
<TD width=17%>р</TD>
<TD width=43%>
<PRE><CODE>DSR</CODE></PRE>
</TD>
</TR>

<TR VALIGN="top">
<TD width=40%>
<PRE><CODE>RTS</CODE></PRE>
</TD>
<TD width=17%>р</TD>
<TD width=43%>
<PRE><CODE>CTS</CODE></PRE>
</TD>
</TR>

<TR VALIGN="top">
<TD width=40%>
<PRE><CODE>DSR</CODE></PRE>
</TD>
<TD width=17%>п</TD>
<TD width=43%>
<PRE><CODE>DTR</CODE></PRE>
</TD>
</TR>

<TR VALIGN="top">
<TD width=40%>
<PRE><CODE>CTS</CODE></PRE>
</TD>
<TD width=17%>п</TD>
<TD width=43%>
<PRE><CODE>RTS</CODE></PRE>
</TD>
</TR>
</TABLE><BR>

<P>По проводам data input/data output происходит последовательная асинхронная передача данных, остальные сигналы соответствуют спецификации RS-232.</P>

<TABLE cols=3 width=355>

<TR VALIGN="top">
<TD width=14%>
<PRE><CODE>DTR</CODE></PRE>
</TD>
<TD width=38%>data terminal ready</TD>
<TD width=48%>готовность устройства</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>
<PRE><CODE>RTS</CODE></PRE>
</TD>
<TD width=38%>request to send</TD>
<TD width=48%>запрос на посылку</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>
<PRE><CODE>DSR</CODE></PRE>
</TD>
<TD width=38%>data set ready</TD>
<TD width=48%>набор данных готов</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>
<PRE><CODE>CTS</CODE></PRE>
</TD>
<TD width=38%>clear to send</TD>
<TD width=48%>передача разрешена</TD>
</TR>
</TABLE><BR>

<P>Каждый сигнал может находиться в одном из двух состояний: поднятом или опущенном (включен или выключен; on или off; high или low; raised или lowered; asserted или de-asserted).</P>

<P>Сигнал DTR поднимается системой Аргус сразу после инициализации COM-порта и означает, что Аргус работает с этим портом. RTS тоже поднимается после инициализации COM-порта, и означает готовность Аргуса принимать данные. Так как чтением из порта в системе Аргус занимается отдельный подпроцесс с повышенным приоритетом, и переполнения буфера приема практически никогда не происходит, сигнал RTS поднят постоянно.</P>

<P>DSR — это входной сигнал от устройства, означающий, что устройство подсоединено и включено, но не обязательно готово принимать данные. CTS это входной сигнал от устройства, означающий, что устройство, кроме того, что подсоединено и включено, готово к приему данных.</P>

<P>DTR и DSR применяются в системе Аргус не контроля потока данных, а для индикации готовности  к работе. Для аппаратного контроля потока в системе Аргус применяются RTS/CTS — если это не запрещено в <A HREF="cfgserial.html">диалоге настройки порта</A>. Эти сигналы обрабатываются драйвером Windows автоматически. При обнаружении заполнения буфера приема драйвер опускает RTS. При обнаружении падения сигнала CTS драйвер приостанавливает передачу.</P>

<h2>Программный контроль потока данных</h2>

<P>Программный контроль потока данных (XOn/XOff flow control) осуществляется двумя специальными символами: символ приостановления потока — XOff  (ASCII 19) и символ продолжения потока — XOn (ASCII 17). Обычно в системе Аргус программный контроль потока данных не используется, но если разрешить его в <A HREF="cfgserial.html">диалоге настройки порта</A>, коммуникационный драйвер будет приостанавливать передачу при получении символа XOff и продолжать при получении XOn. </P>

</BODY>
</HTML>
